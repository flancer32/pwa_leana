<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Dashboard for Leana Hairdresser Salon.">
    <title>Leana Dashboard</title>
    <script>
        async function bootstrap() {

            // DEFINE INNER FUNCTIONS
            /**
             * Import code, create and setup Dependency Injection container for frontend.
             *
             * @returns {Promise<TeqFw_Di_Container>}
             */
            async function initDiContainer() {
                // create and setup DI Container
                const modContainer = await import('../src/@teqfw/di/Container.mjs');
                /** @type {TeqFw_Di_Container} */
                const result = new modContainer.default();
                result.addSourceMapping('Fl32_Leana', '/src/mod/leana', true, 'mjs');
                return result;
            }

            /**
             * Load frontend configuration from API using simple 'fetch'.
             *
             * @returns {Promise<{}>}
             */
            async function loadConfig() {
                // load frontend configuration and user profile
                const res = await fetch('../api/app/config/get');
                const json = await res.json();
                return json.response.config;
            }

            /**
             * Initialize 'i18next' library to use internationalization.
             *
             * @param {Object} app
             * @returns {Promise<i18n>}
             */
            async function initI18n(app) {
                self.i18next.use(self.i18nextBrowserLanguageDetector);
                await self.i18next.init({});
                const appProps = app.config.globalProperties;
                // arrow function uses current scope with 'self'
                appProps.$t = (key, options) => {
                    return self.i18next.t(key, options);
                };
                return self.i18next;
            }

            /**
             * Create and initialize Vue3 router.
             *
             * @returns {*}
             */
            function initRouter() {
                return self.VueRouter.createRouter({
                    history: self.VueRouter.createWebHashHistory(),
                    routes: []
                });
            }

            // MAIN FUNCTIONALITY
            try {
                // initialize objects loader (Dependency Injection container)
                const container = await initDiContainer();
                // create 'teqfw' object in global scope and populate it
                self.teqfw = {};
                self.teqfw.app = self.Vue.createApp({});
                self.teqfw.config = await loadConfig();
                self.teqfw.router = initRouter();
                self.teqfw.i18next = await initI18n(self.teqfw.app);
                // load root component and mount frontend application to DOM
                const appRoot = await container.get('Fl32_Leana_Dashboard_App');
                self.teqfw.app.component('appRoot', appRoot);
                self.teqfw.app.mount('BODY > DIV');
            } catch (e) {
                console.error("Error in bootstrap: " + e + "\n" + e.stack);
            }
        }

        self.addEventListener("load", async () => {
            await bootstrap();
        });
    </script>
</head>
<body>
<div style="height: 100%;">
    <app-root></app-root>
</div>
<!-- load application styles -->
<link rel="stylesheet" href="./styles.css">
<!-- These scripts are not ESM ready for loading with ES6 'import'. Use old style loading.  -->
<script type="application/javascript" src="../node/vue/vue.global.js"></script>
<script type="application/javascript" src="../node/vue-router/vue-router.global.js"></script>
<script type="application/javascript" src="../node/i18next/i18next.min.js"></script>
<script type="application/javascript" src="../node/i18next-bld/i18nextBrowserLanguageDetector.js"></script>
<link rel="stylesheet" href="../node/js-datepicker/datepicker.min.css">
<script type="application/javascript" src="../node/js-datepicker/datepicker.min.js"></script>
<script type="application/javascript" src="../lib/all.js"></script>
</body>
</html>
